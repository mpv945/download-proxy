``` bash
# /etc/systemd/system/download-proxy.service
# GraalVM Native Image 应用的 Systemd 服务配置文件
# 支持主流 Linux 发行版: Ubuntu, CentOS, RHEL, Debian, SUSE, Arch Linux

[Unit]
Description=Download Proxy Service - GraalVM Native Image Application
Documentation=https://github.com/your-org/download-proxy
After=network.target network-online.target
Wants=network-online.target
# 如果依赖数据库或其他服务，添加依赖
# After=mysql.service postgresql.service redis.service
# Requires=mysql.service

[Service]
# ============ 服务类型和启动配置 ============
Type=simple
User=download-proxy
Group=download-proxy
# 如果需要 root 权限（如绑定特权端口），使用：
# User=root
# Group=root

# ============ 应用程序配置 ============
# 可执行文件路径（请根据实际情况修改）
ExecStart=/opt/download-proxy/bin/download-proxy
# 工作目录
WorkingDirectory=/opt/download-proxy
# PID 文件（可选）
PIDFile=/var/run/download-proxy/download-proxy.pid

# ============ 环境变量配置 ============
# 基础环境变量
Environment="LANG=en_US.UTF-8"
Environment="LC_ALL=en_US.UTF-8"
Environment="TZ=Asia/Shanghai"

# 应用程序配置
Environment="SERVER_PORT=8080"
Environment="SERVER_ADDRESS=0.0.0.0"
Environment="SPRING_PROFILES_ACTIVE=prod"

# 日志配置
Environment="LOGGING_LEVEL_ROOT=INFO"
Environment="LOGGING_LEVEL_COM_YOURCOMPANY=DEBUG"
Environment="LOG_FILE=/var/log/download-proxy/application.log"

# 数据库配置（示例）
Environment="DB_HOST=localhost"
Environment="DB_PORT=3306"
Environment="DB_NAME=download_proxy"
Environment="DB_USERNAME=proxy_user"
Environment="DB_PASSWORD=your_secure_password"

# Redis 配置（示例）
Environment="REDIS_HOST=localhost"
Environment="REDIS_PORT=6379"
Environment="REDIS_PASSWORD="

# 文件存储配置
Environment="STORAGE_PATH=/data/files"
Environment="TEMP_DIR=/tmp/download-proxy"

# JVM 相关（虽然是 Native Image，但某些配置仍可能有用）
Environment="MALLOC_ARENA_MAX=2"
Environment="MALLOC_MMAP_THRESHOLD_=131072"

# 网络配置
Environment="HTTP_PROXY="
Environment="HTTPS_PROXY="
Environment="NO_PROXY=localhost,127.0.0.1"

# 性能调优
Environment="GLIBC_TUNABLES=glibc.malloc.mmap_threshold=131072"

# ============ 启动前命令 ============
# 创建必要的目录
ExecStartPre=/bin/mkdir -p /var/log/download-proxy
ExecStartPre=/bin/mkdir -p /var/run/download-proxy
ExecStartPre=/bin/mkdir -p /data/files
ExecStartPre=/bin/chown download-proxy:download-proxy /var/log/download-proxy
ExecStartPre=/bin/chown download-proxy:download-proxy /var/run/download-proxy
ExecStartPre=/bin/chown download-proxy:download-proxy /data/files

# 检查配置文件（可选）
# ExecStartPre=/opt/download-proxy/bin/download-proxy --config-check

# ============ 停止配置 ============
# 优雅停止信号
KillSignal=SIGTERM
# 强制停止前等待时间（秒）
TimeoutStopSec=30
# 停止后执行的命令（可选）
# ExecStopPost=/bin/rm -f /var/run/download-proxy/download-proxy.pid

# ============ 重启策略 ============
Restart=always
RestartSec=10
# 启动失败时的重试次数
StartLimitInterval=60
StartLimitBurst=3

# ============ 资源限制 ============
# 内存限制（2GB）
MemoryMax=2G
MemoryHigh=1.8G

# CPU 限制（80%）
CPUQuota=80%

# 文件描述符限制
LimitNOFILE=65536

# 进程数限制
LimitNPROC=32768

# 核心转储大小限制
LimitCORE=0

# ============ 安全配置 ============
# 私有临时目录
PrivateTmp=true

# 保护系统目录
ProtectSystem=strict

# 保护家目录
ProtectHome=true

# 只读根文件系统（如果应用不需要写入系统目录）
# ReadOnlyPaths=/

# 可写路径
ReadWritePaths=/var/log/download-proxy /var/run/download-proxy /data/files /tmp

# 禁用新的特权
NoNewPrivileges=true

# 保护内核调优参数
ProtectKernelTunables=true

# 保护内核模块
ProtectKernelModules=true

# 保护控制组
ProtectControlGroups=true

# ============ 网络安全 ============
# 如果应用不需要网络访问，可以启用
# PrivateNetwork=true

# 限制地址族（仅 IPv4 和 IPv6）
RestrictAddressFamilies=AF_INET AF_INET6

# ============ 文件系统安全 ============
# 禁止执行权限（如果不需要执行其他程序）
# NoExecPaths=/

# 私有设备
PrivateDevices=true

# ============ 能力限制 ============
# 如果不需要特权端口，移除 CAP_NET_BIND_SERVICE
# CapabilityBoundingSet=CAP_NET_BIND_SERVICE
# AmbientCapabilities=CAP_NET_BIND_SERVICE

# ============ 日志配置 ============
StandardOutput=journal
StandardError=journal
SyslogIdentifier=download-proxy

[Install]
WantedBy=multi-user.target
# 如果需要图形界面，使用：
# WantedBy=graphical.target
```

# 应用部署和服务安装脚本
```bash
#!/bin/bash
# Download Proxy 应用部署脚本
# 支持主流 Linux 发行版: Ubuntu, CentOS, RHEL, Debian, SUSE, Arch Linux

set -e  # 遇到错误立即退出

# ============ 配置变量 ============
APP_NAME="download-proxy"
APP_USER="download-proxy"
APP_GROUP="download-proxy"
APP_HOME="/opt/download-proxy"
APP_BINARY="download-proxy"  # 你的可执行文件名
LOG_DIR="/var/log/download-proxy"
RUN_DIR="/var/run/download-proxy"
DATA_DIR="/data/files"
SERVICE_FILE="/etc/systemd/system/${APP_NAME}.service"

# 颜色输出
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# ============ 函数定义 ============
log_info() {
echo -e "${GREEN}[INFO]${NC} $1"
}

log_warn() {
echo -e "${YELLOW}[WARN]${NC} $1"
}

log_error() {
echo -e "${RED}[ERROR]${NC} $1"
}

log_debug() {
echo -e "${BLUE}[DEBUG]${NC} $1"
}

# 检测 Linux 发行版
detect_os() {
if [[ -f /etc/os-release ]]; then
. /etc/os-release
OS=$NAME
VER=$VERSION_ID
log_info "检测到操作系统: $OS $VER"
else
log_error "无法检测操作系统版本"
exit 1
fi
}

# 检查是否以 root 用户运行
check_root() {
if [[ $EUID -ne 0 ]]; then
log_error "此脚本需要 root 权限运行"
echo "请使用: sudo $0"
exit 1
fi
}

# 检查 systemd 是否可用
check_systemd() {
if ! command -v systemctl &> /dev/null; then
log_error "systemctl 命令未找到，此脚本需要 systemd 支持"
exit 1
fi

    if ! systemctl is-system-running &> /dev/null && ! systemctl is-system-running --quiet 2>/dev/null; then
        log_warn "systemd 可能未正常运行，但继续安装..."
    fi
}

# 创建应用用户和组
create_user() {
if ! id "$APP_USER" &>/dev/null; then
log_info "创建应用用户: $APP_USER"

        # 检测不同发行版的用户创建方式
        if command -v useradd &> /dev/null; then
            # 大多数发行版
            useradd --system --shell /bin/false --home-dir "$APP_HOME" \
                    --create-home --user-group "$APP_USER"
        elif command -v adduser &> /dev/null; then
            # Debian/Ubuntu 的备用方案
            adduser --system --shell /bin/false --home "$APP_HOME" \
                    --group "$APP_USER"
        else
            log_error "无法找到用户创建命令 (useradd/adduser)"
            exit 1
        fi
        
        log_info "用户 $APP_USER 创建成功"
    else
        log_info "用户 $APP_USER 已存在"
    fi
}

# 创建必要的目录
create_directories() {
log_info "创建应用目录结构..."

    directories=(
        "$APP_HOME"
        "$APP_HOME/bin"
        "$APP_HOME/config"
        "$LOG_DIR"
        "$RUN_DIR"
        "$DATA_DIR"
    )
    
    for dir in "${directories[@]}"; do
        if [[ ! -d "$dir" ]]; then
            mkdir -p "$dir"
            log_debug "创建目录: $dir"
        else
            log_debug "目录已存在: $dir"
        fi
    done
    
    # 设置目录权限
    chown -R "$APP_USER:$APP_GROUP" "$APP_HOME"
    chown -R "$APP_USER:$APP_GROUP" "$LOG_DIR"
    chown -R "$APP_USER:$APP_GROUP" "$RUN_DIR"
    chown -R "$APP_USER:$APP_GROUP" "$DATA_DIR"
    
    # 设置适当的权限
    chmod 755 "$APP_HOME"
    chmod 755 "$APP_HOME/bin"
    chmod 755 "$LOG_DIR"
    chmod 755 "$RUN_DIR"
    chmod 755 "$DATA_DIR"
    
    log_info "目录创建和权限设置完成"
}

# 复制应用文件
install_application() {
local binary_path="$1"

    if [[ -z "$binary_path" || ! -f "$binary_path" ]]; then
        log_error "请提供有效的可执行文件路径"
        echo "使用方法: $0 /path/to/your/download-proxy"
        exit 1
    fi
    
    log_info "安装应用程序: $binary_path -> $APP_HOME/bin/$APP_BINARY"
    
    # 复制可执行文件
    cp "$binary_path" "$APP_HOME/bin/$APP_BINARY"
    
    # 设置执行权限
    chmod 755 "$APP_HOME/bin/$APP_BINARY"
    chown "$APP_USER:$APP_GROUP" "$APP_HOME/bin/$APP_BINARY"
    
    # 验证文件
    if [[ -x "$APP_HOME/bin/$APP_BINARY" ]]; then
        log_info "应用程序安装成功"
        # 显示文件信息
        ls -la "$APP_HOME/bin/$APP_BINARY"
    else
        log_error "应用程序安装失败"
        exit 1
    fi
}

# 创建环境变量配置文件
create_env_file() {
local env_file="$APP_HOME/config/app.env"

    log_info "创建环境变量配置文件: $env_file"
    
    cat > "$env_file" << 'EOF'
# Download Proxy 应用环境变量配置文件
# 可以根据需要修改这些变量

# ============ 基础配置 ============
LANG=en_US.UTF-8
LC_ALL=en_US.UTF-8
TZ=Asia/Shanghai

# ============ 应用配置 ============
SERVER_PORT=8080
SERVER_ADDRESS=0.0.0.0
SPRING_PROFILES_ACTIVE=prod

# ============ 日志配置 ============
LOGGING_LEVEL_ROOT=INFO
LOGGING_LEVEL_COM_YOURCOMPANY=DEBUG
LOG_FILE=/var/log/download-proxy/application.log

# ============ 数据库配置 ============
DB_HOST=localhost
DB_PORT=3306
DB_NAME=download_proxy
DB_USERNAME=proxy_user
DB_PASSWORD=your_secure_password

# ============ Redis 配置 ============
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# ============ 文件存储配置 ============
STORAGE_PATH=/data/files
TEMP_DIR=/tmp/download-proxy

# ============ 网络配置 ============
HTTP_PROXY=
HTTPS_PROXY=
NO_PROXY=localhost,127.0.0.1

# ============ 性能配置 ============
MALLOC_ARENA_MAX=2
MALLOC_MMAP_THRESHOLD_=131072
GLIBC_TUNABLES=glibc.malloc.mmap_threshold=131072
EOF

    chown "$APP_USER:$APP_GROUP" "$env_file"
    chmod 640 "$env_file"  # 只有用户和组可读，防止密码泄露
    
    log_info "环境变量配置文件创建完成"
    log_warn "请编辑 $env_file 文件，设置正确的配置参数"
}

# 创建 systemd 服务文件
create_service_file() {
log_info "创建 systemd 服务文件: $SERVICE_FILE"

    cat > "$SERVICE_FILE" << EOF
[Unit]
Description=Download Proxy Service - GraalVM Native Image Application
Documentation=https://github.com/your-org/download-proxy
After=network.target network-online.target
Wants=network-online.target

[Service]
Type=simple
User=$APP_USER
Group=$APP_GROUP

# 应用程序配置
ExecStart=$APP_HOME/bin/$APP_BINARY
WorkingDirectory=$APP_HOME
PIDFile=$RUN_DIR/${APP_NAME}.pid

# 环境变量文件
EnvironmentFile=-$APP_HOME/config/app.env

# 启动前命令
ExecStartPre=/bin/mkdir -p $LOG_DIR
ExecStartPre=/bin/mkdir -p $RUN_DIR
ExecStartPre=/bin/mkdir -p $DATA_DIR
ExecStartPre=/bin/chown $APP_USER:$APP_GROUP $LOG_DIR
ExecStartPre=/bin/chown $APP_USER:$APP_GROUP $RUN_DIR
ExecStartPre=/bin/chown $APP_USER:$APP_GROUP $DATA_DIR

# 停止配置
KillSignal=SIGTERM
TimeoutStopSec=30

# 重启策略
Restart=always
RestartSec=10
StartLimitInterval=60
StartLimitBurst=3

# 资源限制
MemoryMax=2G
MemoryHigh=1.8G
CPUQuota=80%
LimitNOFILE=65536
LimitNPROC=32768
LimitCORE=0

# 安全配置
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=$LOG_DIR $RUN_DIR $DATA_DIR /tmp
NoNewPrivileges=true
ProtectKernelTunables=true
ProtectKernelModules=true
ProtectControlGroups=true
RestrictAddressFamilies=AF_INET AF_INET6
PrivateDevices=true

# 日志配置
StandardOutput=journal
StandardError=journal
SyslogIdentifier=$APP_NAME

[Install]
WantedBy=multi-user.target
EOF

    log_info "systemd 服务文件创建完成"
}

# 安装和启动服务
install_service() {
log_info "重新加载 systemd 配置..."
systemctl daemon-reload

    log_info "启用 $APP_NAME 服务..."
    systemctl enable "$APP_NAME"
    
    log_info "启动 $APP_NAME 服务..."
    if systemctl start "$APP_NAME"; then
        log_info "服务启动成功"
    else
        log_error "服务启动失败"
        log_info "检查服务状态: systemctl status $APP_NAME"
        log_info "查看日志: journalctl -u $APP_NAME -f"
        exit 1
    fi
}

# 显示服务状态
show_status() {
log_info "服务状态:"
systemctl status "$APP_NAME" --no-pager -l

    echo
    log_info "常用命令:"
    echo "  启动服务: sudo systemctl start $APP_NAME"
    echo "  停止服务: sudo systemctl stop $APP_NAME"
    echo "  重启服务: sudo systemctl restart $APP_NAME"
    echo "  查看状态: sudo systemctl status $APP_NAME"
    echo "  查看日志: sudo journalctl -u $APP_NAME -f"
    echo "  禁用服务: sudo systemctl disable $APP_NAME"
    echo
    echo "  配置文件: $APP_HOME/config/app.env"
    echo "  日志目录: $LOG_DIR"
    echo "  数据目录: $DATA_DIR"
}

# 卸载函数
uninstall() {
log_warn "开始卸载 $APP_NAME 服务..."

    # 停止并禁用服务
    if systemctl is-active --quiet "$APP_NAME"; then
        log_info "停止服务..."
        systemctl stop "$APP_NAME"
    fi
    
    if systemctl is-enabled --quiet "$APP_NAME"; then
        log_info "禁用服务..."
        systemctl disable "$APP_NAME"
    fi
    
    # 删除服务文件
    if [[ -f "$SERVICE_FILE" ]]; then
        rm -f "$SERVICE_FILE"
        log_info "删除服务文件: $SERVICE_FILE"
    fi
    
    # 重新加载 systemd
    systemctl daemon-reload
    
    log_warn "卸载完成。用户、目录和数据未删除，如需彻底清理请手动执行："
    echo "  sudo userdel -r $APP_USER"
    echo "  sudo rm -rf $APP_HOME $LOG_DIR $RUN_DIR $DATA_DIR"
}

# 主函数
main() {
local binary_path="$1"
local action="${2:-install}"

    log_info "Download Proxy 服务部署脚本启动..."
    
    # 基础检查
    detect_os
    check_root
    check_systemd
    
    case "$action" in
        "install")
            if [[ -z "$binary_path" ]]; then
                log_error "请提供可执行文件路径"
                echo "使用方法: $0 /path/to/download-proxy [install|uninstall]"
                exit 1
            fi
            
            create_user
            create_directories
            install_application "$binary_path"
            create_env_file
            create_service_file
            install_service
            show_status
            ;;
        "uninstall")
            uninstall
            ;;
        *)
            log_error "未知操作: $action"
            echo "支持的操作: install, uninstall"
            exit 1
            ;;
    esac
}

# 脚本入口
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
main "$@"
fi
```

1. 部署应用
```bash
# 1. 赋予脚本执行权限
chmod +x deploy.sh

# 2. 安装应用（需要 sudo 权限）
sudo ./deploy.sh /path/to/your/download-proxy install

# 3. 编辑环境变量配置
sudo nano /opt/
```
